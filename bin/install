#!/bin/bash -eux

case "$1" in
  -v|--version)
    version="$2"
esac

CPUMINER_DOWNLOAD_URL="http://sourceforge.net/projects/cpuminer/files/pooler-cpuminer-$version-linux-x86_64.tar.gz"

# Download the precompiled cpuminer binary

pushd /tmp >/dev/null
wget -q $CPUMINER_DOWNLOAD_URL 
tar -xzf pooler-cpuminer-$version-linux-x86_64.tar.gz
mv minerd ${OPENSHIFT_CPUMINER_DIR}bin/minerd
rm -rf pooler-cpuminer-$version-linux-x86_64.tar.gz
chmod +x ${OPENSHIFT_CPUMINER_DIR}bin/minerd
popd >/dev/null

echo "$version" > "$OPENSHIFT_CPUMINER_DIR/env/OPENSHIFT_CPUMINER_VERSION"
